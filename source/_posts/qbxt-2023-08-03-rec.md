---
title: QBXT 2023.8.3 模拟赛 做题记录
date: 2023-08-05 23:10:03
categories: 做题记录
---

90 + 100 + 72 + 29．

挂分．/oh

## A. 子序列

拆贡献，然后做完了．

## B. 排列

设 $f_{i, j}$ 表示长为 $i$，峰数为 $j$ 的排列数目．

考虑插入 $i$．插在峰两边或序列两头不会改变峰数，插在其他地方都会增加一个峰．那么有转移：

$$
f_{i, j} = (2j + 2) \times f_{i - 1, j} + (i - 2j) \times f_{i - 1,j - 1}
$$

## C. 闪电

卡空间．/tuu

首先容易设计一个 2D / 1D 的 DP，然后利用前缀和优化到 $O(n^2)$．然后我们发现出题人卡了空间．/qd

那么我们考虑将点按 $x$ 排序，然后设 $f_{i, 0 / 1}$ 表示考虑从 $i$ 出发，第一个向 左 / 右 偏转的闪电个数．转移考虑插入点 $i$ 作为闪电中的第一个点或第二个点造成的贡献．

## D. 三

定义一个三元组 $(i, j, k)$ 的价值为 $a_i + a_j + a_k$．

假设在一次询问中，我们作为答案的三元组为 $(i, j, k)$．尝试观察能够作为答案的三元组的性质．

- 如果 $a_i < a_j$，且存在 $i < p < j$ 使得 $a_p > a_i$，显然 $(p, j, k)$ 合法且更优．
- 如果 $a_i > a_j$，且存在 $i < p < j$ 使得 $a_p > a_j$，显然 $(i, p, k)$ 合法且更优．

那么每个数可以与左 / 右边第一个比它大的数作为答案中的前两个，有用的前两个形成的对只有 $O(n)$ 个．

考虑 **从右到左** 进行扫描线，对每个位置维护值 $c_i$ 表示三元组 $(x, y, i)$ 取到最大价值时，$a_x + a_y$ 的值，答案就是区间内 $a_i + c_i$ 的最大值．$l \to l - 1$ 的过程中，考虑插入 $a_l$ 造成的影响，将 $l$ 作为第一个元组的有用的对加入时，对 $c_i$ 的影响形如后缀取 $\max$．具体而言，设当前加入的对是 $(l, i)$，那么相当于将 $[i + (i - l), n]$ 这段后缀对 $a_l + a_i$ 取 $\max$．

以下是一些民科内容，**不保证正确性**，建议不看．

注意此处从左到右扫描线不可做．因为若想从左到右进行扫描线，我们必定要在三元组的第一个数处计算贡献，不然区间查询就废掉了．这样的话我们就需要找到关于三元组中后两个元素的性质，然而注意到我们的不等号方向是 $j - i \le k - j$，考虑前两个数形成的对时，我们对答案做的调整是在放松这个不等式．但当我们尝试调整后两个数形成的对时，我们是在往紧的方向调整，然后性质就不好了．
