---
title: QBXT 2023 国庆集训 做题记录
date: 2023-10-11 14:26:58
categories: 做题记录
---

怎么比去年的自己还菜的．

<!-- more -->

## Day 1

100 + 30 + 0 + 100．

### A. 正方形

二维 ST 表弄个关于颜色的 bitset，然后就可以二分了．

### B. 等差

诈骗题．一眼看到了一个不弱于快速阶乘算法的东西，然而模数够小，于是 $n$ 过大的时候就直接寄了．

$d = 1$ 是简单的，预处理阶乘及其逆元就可以做了．其他情况给每项除个 $d$ 就做完了．

### C. npc 与 slime

即对 npc 创不死玩家的地图计数．注意到由于玩家左侧只会有 slime，且人类只能通过 slime 来刷级，所以 npc 能够创死在 $i$ 玩家当且仅当玩家右侧存在一个长度 $> s_i + i - 1$ 的 slime 连续段．

直接钦定 $i$ 个 slime 连续段和其后的 npc 然后容斥即可．注意讨论是否钦定 $n$ 号位置的 npc．

### D. 矿泉水

注意到任何时刻序列单调不升，所以考虑维护轮廓线．

用 set 维护拐点即可．细节有点多．

当然也可以线段树！只是我傻逼了没想到．

## Day 2

100 + 50 + 50 + 100．

### A. 阶乘

考虑算出 $n!$ 的质因数分解．注意到 $a_i \le 2 \times 10^5$，故只用保留 $2 \times 10^5$ 内的质数即可．

然后给 $a$ 排序，从小到大贪心拿，正确性显然．拿的操作直接暴力做就好了，我也不知道为什么是对的．

### B. 合并

典中典区间 DP，为啥写挂了呢．

设 $f_{l, r}$ 表示合并区间 $[l, r]$ 的最小代价，转移枚举区间断点，钦定断点到某个端点的距离是 $k - 1$ 的倍数．然后直接转移就能过了．

### C. 填数

首先注意到对于互相包含的限制区间，大的那个没用，直接去掉．问题转化为对多个互不包含的区间限制计算方案数．

这个限制不漂亮，考虑计算对于所有的区间，内部都不存在相同数的序列数量．

把区间按照右端点升序排序，考虑设计一个 DP．设 $f_{i, j}$ 表示考虑了前 $i$ 个区间，钦定满足 $j$ 个区间限制的方案数．转移考虑枚举上一个区间：

1. 若相交，发现相交部分已经处理过，只需处理新增部分的方案数．
2. 若不相交，需乘上中间部分随便选的方案数．

然而这样时间复杂度是 $O(n^3)$ 的，无法通过本题．发现由于要容斥，事实上我们只关心 $j$ 的奇偶性，那么第二维只用记录 $0 / 1$ 即可．

### D. 无向图

首先先二分，转化成对 $< \lambda$ 的边计数．

记录一个全集的值域线段树，再对每个点记录其邻接边的值域线段树．若查询的 $k$ 个点之间没有连边，直接差分就能计算答案．

若 $k$ 个点之间有边，发现会被多减去 $1$ 次，加回来即可．

## Day 3

50 + 100 + 70 + 0．

### A. mexor

乱搞一下就 50 分，再乱搞一下就过了．

不是很懂啊．

### B. wbtree

不难发现和自己子树中最浅的没有匹配过的点匹配是最优的．线段树合并即可．

### C. andgraph

考虑优化建图，对每一位建一个虚点，若 $a_i$ 的第 $j$ 位为 $1$，$i$ 往虚点 $j$ 连一条权为 $a_i$ 的边．容易发现最短路意义不变．

然而这样需要跑 $n$ 次最短路，寄了．考虑最短路一定形如 $u \to$ 虚点 $\to \cdots \to$ 虚点 $\to v$．考虑处理出两虚点之间的最短路，然后枚举 $u$ 和 $v$ 走哪个虚点．时间复杂度为 $O(n \log^2 n)$，已经可以通过本题．

预处理虚点 $\to v$ 这一部分后可以做到 $O(n \log n)$．好像还能更牛一点，但是不会了．

### D. splitham

巨大恶心 DP．

注意到每次划分出的集合是确定的，故可以设 $f_{i, S, j}$ 表示正在走 $S$，从 $i$ 开始从 $j$ 结束的最短路．

转移枚举分割出的两部分 $P$ 和 $Q$ 的入点 $x$ 和出点 $y$，有

$$
f_{i, S, j} = \min_{x, y} f_{i, P, x} + \operatorname{dist}(x, y) + f_{y, Q, j}
$$

根据经典结论，这个状态数是 $O(n^2)$ 的．

然后预处理所有 $x$ 的 $\min\limits_y \operatorname{dist}(x, y) + f_{y, Q, j}$ 即可 $O(n^3)$ 转移．

## Day 4

100 + 0 + 100 + 0．

### A. 小葱买糖

对质因子根号分治，小于 $\sqrt{10^9}$ 的直接开桶计，大于 $\sqrt{10^9}$ 的至多 $n$ 个，开个数组记下来然后去重．最后乘起来．

### B. 小葱拿糖

大搜索．不会．

### C. 小葱吃糖

设 $d_i$ 表示原序列 $[1, i]$ 这段前缀形成的数，则一个区间 $[l, r]$ 可以被吃掉当且仅当 $d_r - d_{l - 1} 10^{r - l + 1} \equiv 0 \pmod p$．

整理一下式子，即对 $l \le x < y \le r$ 且满足 $d_x 10^{y - x} \equiv d_y \pmod p$ 的点对计数．

考虑分治．设当前分治区间为 $[l, r]$，对跨越分治中点 $m = \lfloor (l + r) / 2 \rfloor$ 的点对 $(x, y)$ 计数．由于跨过了分治中点，我们可以将式子写为 $d_x 10^{m - x} 10^{y - m} \equiv d_y \pmod p$．预处理 $f_i$ 表示 $[l, m]$ 中满足 $d_x 10^{m - x} = i$ 的 $x$ 数量和 $g_{i, j}$ 表示 $[m + 1, r]$ 中满足 $10^{y - m} = i$，$f_y = j$ 的 $y$ 的个数，然后枚举 $i = d_x 10^{m - x}$ 和 $j = 10^{y - m}$，跨中点的点对数目就是 $\sum_i \sum_j f_i \times g_{j, ij}$．

此时不带修的问题已经可以通过离线询问后一遍分治解决，考虑带修，发现分治过程中维护的信息数量是 $\Theta(p^2)$ 的，可以直接丢上线段树．

时间复杂度 $\Theta(n p^2 \log n)$．

### D. 小葱卖糖

大 DP，不会．
