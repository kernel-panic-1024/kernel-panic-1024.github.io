---
title: QBXT 2023 NOIp 集训 做题记录
date: 2023-11-09 18:00:54
categories: 做题记录
---

借某人的号做的．

<!-- more -->

## Day 1 上午

### A. kimi

显然只会去换两国货币面值最小的那一种货币，直接枚举某国的换多少即可．

### * B. no

一眼的贪心假了．/ll

第一问直接选择当前能到的点中编号最小的那一个即可．

第二问不能贪心选最大的访问，因为当前可以访问的节点中可能有些可以访问且不会造成代价的节点，先访问这些节点可能可以解锁一些编号更大的点．于是先将可以走完的点走完再取最大的即可．

### * C. shiranai

原题是 [gym101821B](https://codeforces.com/gym/101821/problem/B)．

注意到选出的 LIS 和 LDS 中一定存在一个位置，使得在这一位置之前，LDS 的所有元素大于 LIS 的所有元素，在这位置之后，LDS 的所有元素都小于 LIS 的元素．我们称这一位置为“交点”．

考虑枚举 LIS 中交点前的一个位置 $i$，并钦定 LDS 中交点前的一个元素在 $i$ 之前，容易发现在 $i$ 之后的情况可以通过把序列倒过来再做一遍规避掉．

考虑可以选择哪些位置的两个点拼接起来．如下图：

![爱来自 mspaint](/images/qbxt-2023-11-rec/1.png)

其中红点是在 LIS 中相邻的两个元素，我们需要在 A 或 B 区间中选择某个元素，然后再从 C 中选择一个元素，使得以第一个选择的元素结尾的 LDS 拼上以第二个选择的元素为开头的 LDS 长度等于全局 LDS．若能选出来，显然能给出一组合法构造．

如何选？先考虑 A，C 两区域内选元素的方案，这显然在两部分中贪心选最长的即可，因为有 $i + 1$ 的值的限定，无论如何选都是合法的．

B，C 区域选元素的方案貌似不好统计，但是我们可以维护一个处于 LDS 中的元素，他可选的后继元素最远在哪．若 B 区域中的元素后继最远距离超过 $i$，选择这两个就是一个合法方案．

代码非常 /tuu．

### * D. monogatari

显然由于权值互不相同，好路径的条数不超过 $n$ 个．

考虑一个过程，从 $0$ 开始枚举 $L$，每次将权值 $= L$ 的点加入到图中，若枚举到 $x$ 时连通块个数为 $1$ 且是一条链，那么长度为 $x$ 的好路径存在．

先考虑路径祖先到儿子的情况，我们只需维护加入权值 $\le i$ 时，所有连通块的叶子数，查询就是查询全局 $1$ 的个数．由于修改是交换两个点的权值，所以只需要重算会改动的 $O(1)$ 个点的贡献即可．又由于叶子数不会小于 $1$，所以直接使用线段树维护区间最小值和最小值出现次数即可．

再考虑路径是 $u$ 向上到 $w$，$w$ 再向下到 $v$ 的情况，其中 $w$ 是 $u$ 和 $v$ 的 LCA．考虑在 $w$ 处统计这种路径的贡献．发现若一个点能够计入贡献，当且仅当它是在枚举过程中第一个具有两个儿子的点，且它的父亲没有被选，它可能贡献到的 $L$ 是一段区间，这个区间可以使用 `std::set` 维护，我们只需要找到这个区间内合法的位置有多少个，即对等于 $2$ 的位置计数．由于区间内的位置，值至少为 $2$，所以直接查询区间最小值及其出现次数即可．

## Day 1 下午

### A. 芙莉莲

首先每位独立，然后只需计算出有几位可以填两种值，分讨即可．

### B. 新娘

首先可以通过一些交换，将所有情况转化为 $x_u < x_v$ 且 $y_u < y_v$ 的情况．

由于查询矩形被 $u$ 和 $v$ 对应的点构成的矩形包含，所以 Manhattan 距离的绝对值可以直接去掉．将第三问的式子写出来：

$$
x - x_u + y - y_u < x_v - x + y_v - y \iff y < -x + \frac{x_u + y_u + x_v + y_v}{2}
$$

发现答案形如矩形内在某条直线下方的整点数．事实上我们只需算出 $x$ 坐标在某一区间内，在某条斜率为 $-1$ 的直线下方，在某条斜率为 $0$ 的直线上方的整点数目，其他答案都可以通过差分得到．这个问题可以分讨第二条线关于第一条线和界的交点的位置关系，然后就是一个等差数列求和．

### * C. 虚假的圣所

拜谢 ckain．

不妨令全局权值和为 $s$，$u$ 子树的权值和为 $\mathrm{sum}_u$．

先考虑没有选择点集限制的时候怎么做．由于选择 $u$ 时的答案形式为 $\max\{\max_v \mathrm{sum}_v, s - \mathrm{sum}_u\}$，由于需要单点修改点权，所以两部分不能直接维护．考虑 $\max$ 会如何决策，发现若我们找到深度最深的一个 $\mathrm{sum}_u \ge \frac{s}{2}$ 的点，在这个点的祖先链上的所有点都取的第一部分，其他点取的都是第二部分．由于取第二部分的点构成一条 dfn 序单调递增的链，故我们可以直接在 dfn 序上二分，取最后一个满足这个条件的点即可．

现在考虑如何查询，对于链上的点，显然选最深的那一个点的最大子树，轻重链剖分后维护区间 $\mathrm{sum}_u$ 的最大值即可统计．不在链上的点都取的 $s - \mathrm{sum}_u$，且轻重链剖分后这些点的 dfn 也处在 $O(\log n)$ 个区间中，贪心选最大的 $\mathrm{sum}_u$ 即可．

考虑带上点集限制怎么做．对于不在链上的点，直接将不能选的位置赋值成 $-\infty$ 即可，但是链上的点的决策需要一点讨论，我们需要找到最深的一个可以选的点，取它的最大子树即可．

时间复杂度 $O(n \log^2 n)$．

### ! D. 乘兴

还没补．暂时．

## Day 2

### A. 我现在肺痒痒

暴力即可．

### B. 烟 distance

首先，$(\gcd, \mathrm{len})$ 的二元组只有 $O(d(n))$ 个，可以枚举．现在考虑钦定了 $\gcd$ 和长度的方案该如何计算．

有一个 naive 的想法是，我们统计包含 $i$ 作为因数的元素个数 $\mathrm{ct}_i$，二元组 $(i, \mathrm{len})$ 的方案数就是 $\binom{\mathrm{ct}_{i}}{\mathrm{len}}$．这显然是错的，因为有些 $\gcd$ 是 $i$ 的倍数的子序列也将会被统计．若设 $f_i$ 表示 $\gcd = i$ 时的子序列数，有

$$
\binom{\mathrm{ct}_{i}}{\mathrm{len}} = \sum_{i | d} f_d
$$

这不是我们 Mobius 反演的题目吗！直接反演得到

$$
f_i = \sum_{i | d} \mu(d / i) \binom{\mathrm{ct}_{d}}{\mathrm{len}}
$$

然后就可以 $O(\sqrt{n} + n \log n)$ 计算了．

### * C. I got smoke

由于 $i$ 步能造出的状态是指数级的，猜测这几个运算的循环节都是 $O(V)$ 的，故答案不会超过 $O(\log V)$．

此时直接搜索的复杂度是 $O(V)$ 的，爆炸了．考虑一个双向搜索，复杂度就是 $O(\sqrt{V})$ 了．

$31$ 次幂的逆运算，由于模 $998244352$ 意义下 $31$ 存在逆元，直接求出逆元后算 $31^{-1}$ 次幂即可．

### ! D. Zood

还没补．暂时．

## Day 3 上午

### A. 交易资金

考虑第一次询问什么．假如第一次询问 $i$，那么对于初始预算 $\ge i$ 的情况，都可以直接拿到钱，剩下的需要继续猜，其中预算 $\le k$ 的情况已经废了，剩下的是一模一样的子问题．于是我们可以设计 DP，设 $f_i$ 表示预算在 $[1, i]$ 的所有情况，最终得到钱数和的最大值，有转移：

$$
f_i = \max_{j \le i} \{f_{i - j - k} + j(i - j + 1)\}
$$

这个时候已经可以斜率优化了，但是我打表发现决策点单调增，直接双指针就能过去．

### B. * 异或

先给树随便定个根．

考虑将 $u$ 的每个子节点子树的异或值钦定为 $0 \sim |C_u| - 1$，其中 $C_u$ 表示 $u$ 的儿子集合．

这样就只剩下去掉 $u$ 子树部分的异或值需要考虑，我们直接
