---
title: 矩阵做标记时的常数优化技巧
date: 2023-03-27 22:59:05
categories: Tricks
tags:
- 矩阵
- 线段树
---
~~对我这种彩笔而言~~，线段树维护历史和时，标记通常难以推出并难以确定下传顺序，这时候为了节省时间，一般会将标记写成矩阵的形式．

这样虽然省下了推标记的时间，但是矩阵的大小动辄 $5 \times 5$ 往上，带来的常数影响是巨大的，~~通常会使我的程序挂成暴力~~．

如何省下一些这样的常数呢？~~通过观摩 uoj 群中的大佬讨论~~我们可以发现，由于维护的信息量不大，矩阵中的很多值实际上都是没有用的，那么我们可以将有用的值单独拿出来维护．

如何找到这样的值呢？我们可以随机出一些修改矩阵乘到单位矩阵上，多次进行这样的过程，并对结果累加，累加出来的矩阵中有值的元素就是我们需要的维护的元素．

如果累加后矩阵中的某个元素的值等于累加次数，那么这个位置的值大概率恒为 $1$，不需要维护它．

需要注意的是，多随机几次，不然无法保证正确性．
